<!DOCTYPE html>
<!-- Updated: 2025-01-27 - All features now working -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maya - Interactive Malay Learning Chatbot</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            text-align: center;
            color: #2E7D32;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .header p {
            font-size: 14px;
            color: #666;
        }
        .nav-menu {
            background: rgba(255,255,255,0.9);
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .nav-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        .nav-btn:hover, .nav-btn.active {
            background: #2E7D32;
        }
        .content-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        .section {
            display: none;
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .section.active {
            display: block;
        }
        .section h2 {
            color: #2E7D32;
            margin-bottom: 15px;
        }
        .quiz-themes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .theme-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        .theme-card:hover {
            border-color: #4CAF50;
            transform: translateY(-2px);
        }
        .theme-card h3 {
            color: #2E7D32;
            font-size: 16px;
            margin-bottom: 8px;
        }
        .theme-card p {
            color: #666;
            font-size: 14px;
        }
        .quiz-question {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .quiz-options {
            display: grid;
            gap: 8px;
            margin-top: 10px;
        }
        .quiz-option {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
        }
        .quiz-option:hover {
            background: #2E7D32;
        }
        .quiz-option:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .score {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #4CAF50;
            margin: 20px 0;
        }
        .chat-container {
            max-height: 400px;
            overflow-y: auto;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            word-wrap: break-word;
        }
        .user-message {
            background: #4CAF50;
            color: white;
            margin-left: auto;
        }
        .bot-message {
            background: rgba(255,255,255,0.95);
            color: #2E7D32;
        }
        .bilingual {
            font-style: italic;
            opacity: 0.8;
            font-size: 0.9em;
            margin-top: 5px;
        }
        .input-container {
            background: rgba(255,255,255,0.9);
            padding: 15px;
            display: flex;
            gap: 10px;
        }
        #messageInput {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
            font-size: 16px;
        }
        #sendButton {
            padding: 12px 24px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
        }
        .quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }
        .quick-reply {
            background: rgba(255,255,255,0.8);
            color: #2E7D32;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
        }
        .roleplay-scenarios {
            display: grid;
            gap: 15px;
        }
        .scenario-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            margin: 5px;
        }
        .btn:hover {
            background: #2E7D32;
        }
        .dialogue-preview {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 3px solid #4CAF50;
        }
        .dialogue-preview p {
            margin: 5px 0;
            color: #2E7D32;
            font-size: 14px;
        }

        /* Daily Phrases Styles */
        .phrase-container {
            max-width: 800px;
            margin: 0 auto 30px;
        }

        .current-phrase {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .phrase-header h3 {
            margin: 0 0 10px 0;
            font-size: 1.2em;
        }

        .phrase-meta {
            opacity: 0.9;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        .phrase-malay {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .phrase-english {
            font-size: 1.4em;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .phrase-audio-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .phrase-audio-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .phrase-navigation {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .nav-phrase-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .nav-phrase-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .week-selector {
            text-align: center;
            margin-bottom: 30px;
        }

        .week-selector h3 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .week-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            max-width: 800px;
            margin: 0 auto;
        }

        .week-btn {
            background: white;
            border: 2px solid #3498db;
            color: #3498db;
            padding: 15px 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .week-btn:hover, .week-btn.active {
            background: #3498db;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .week-btn small {
            display: block;
            font-weight: normal;
            opacity: 0.8;
            margin-top: 5px;
        }

        .phrases-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .phrase-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
            transition: transform 0.3s ease;
        }

        .phrase-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .phrase-card-category {
            color: #3498db;
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .phrase-card-malay {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .phrase-card-english {
            color: #666;
            font-size: 1em;
            margin-bottom: 10px;
        }

        .phrase-card-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s ease;
        }

        .phrase-card-btn:hover {
            background: #2980b9;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üá∏üá¨ Maya - Interactive Malay Learning Chatbot</h1>
        <p>Learn Singapore Malay through conversation, quizzes, and role-playing scenarios</p>
    </div>
    
    <div class="nav-menu">
        <button class="nav-btn active" onclick="showSection('home')">Home</button>
        <button class="nav-btn" onclick="showSection('chat')">Interactive Chat</button>
        <button class="nav-btn" onclick="showSection('quiz')">Quiz</button>
        <button class="nav-btn" onclick="showSection('phrases')">Daily Phrases</button>
    </div>
    
    <div class="content-area">
        <!-- Home Section -->
        <div class="section active" id="home">
            <h2>Welcome to Maya! üåü</h2>
            <p><strong>What is Maya?</strong><br>
            Maya is your friendly Singapore Malay learning companion! Practice conversational Malay, test your knowledge with quizzes, and engage in real-life scenarios.</p>
            
            <p><strong>Features:</strong><br>
            üó£Ô∏è <strong>Interactive Chat:</strong> Practice conversations and role-playing scenarios with English translations<br>
            üß† <strong>Knowledge Quiz:</strong> Test your vocabulary and grammar across 14 different themes<br>
            üìÖ <strong>Daily Phrases:</strong> Learn essential phrases through an 8-week structured program<br>
            üåç <strong>Singapore Context:</strong> Learn authentic Singapore Malay expressions</p>
            
            <p><strong>How to use:</strong><br>
            Click on the tabs above to navigate between different learning modes. Start with Daily Phrases to learn essential vocabulary, then practice with Chat conversations!</p>
        </div>

        <!-- Chat Section -->
        <div class="section" id="chat">
            <h2>üí¨ Chat with Maya</h2>
            <div class="chat-container" id="chat-container">
                <div class="message bot-message">
                    Selamat datang! Saya Maya. Mari bercakap dalam Bahasa Melayu! üòä
                    <div class="bilingual">Welcome! I'm Maya. Let's chat in Malay!</div>
                </div>
            </div>
            
            <div class="quick-replies">
                <button class="quick-reply" onclick="startTopicConversation('greetings')">ü§ù Greetings</button>
                <button class="quick-reply" onclick="startTopicConversation('food')">üçú Food</button>
                <button class="quick-reply" onclick="startTopicConversation('shopping')">üõí Shopping</button>
                <button class="quick-reply" onclick="startTopicConversation('transport')">üöá Transport</button>
                <button class="quick-reply" onclick="startTopicConversation('work')">üíº Work</button>
                <button class="quick-reply" onclick="startTopicConversation('family')">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family</button>
                <button class="quick-reply" onclick="startTopicConversation('weather')">üå¶Ô∏è Weather</button>
                <button class="quick-reply" onclick="startTopicConversation('hobbies')">üé® Hobbies</button>
                <button class="quick-reply" onclick="resetConversation(); updateQuickReplies()">üîÑ More Topics</button>
            </div>
        </div>

        <!-- Quiz Section -->
        <div class="section" id="quiz">
            <h2>üß† Malay Quiz - Choose Your Theme</h2>
            <div class="quiz-themes" id="quiz-themes">
                <div class="theme-card" onclick="startQuiz('greetings')">
                    <h3>ü§ù Greetings & Politeness</h3>
                    <p>Basic greetings, please, thank you, and polite expressions</p>
                </div>
                <div class="theme-card" onclick="startQuiz('family')">
                    <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family & Relationships</h3>
                    <p>Family members, relationships, and personal connections</p>
                </div>
                <div class="theme-card" onclick="startQuiz('food')">
                    <h3>üçú Food & Drinks</h3>
                    <p>Hawker center favorites, local dishes, and beverages</p>
                </div>
                <div class="theme-card" onclick="startQuiz('transport')">
                    <h3>üöá Transportation</h3>
                    <p>MRT, buses, taxis, and getting around Singapore</p>
                </div>
                <div class="theme-card" onclick="startQuiz('shopping')">
                    <h3>üõí Shopping</h3>
                    <p>Markets, malls, bargaining, and making purchases</p>
                </div>
                <div class="theme-card" onclick="startQuiz('numbers')">
                    <h3>üî¢ Numbers & Time</h3>
                    <p>Counting, telling time, dates, and quantities</p>
                </div>
                <div class="theme-card" onclick="startQuiz('body')">
                    <h3>üè• Body & Health</h3>
                    <p>Body parts, health conditions, and medical terms</p>
                </div>
                <div class="theme-card" onclick="startQuiz('colors')">
                    <h3>üåà Colors & Descriptions</h3>
                    <p>Colors, sizes, shapes, and descriptive words</p>
                </div>
                <div class="theme-card" onclick="startQuiz('weather')">
                    <h3>üå¶Ô∏è Weather & Nature</h3>
                    <p>Weather conditions, seasons, and natural elements</p>
                </div>
                <div class="theme-card" onclick="startQuiz('home')">
                    <h3>üè† Home & Living</h3>
                    <p>House parts, furniture, and household items</p>
                </div>
                <div class="theme-card" onclick="startQuiz('work')">
                    <h3>üíº Work & School</h3>
                    <p>Occupations, school subjects, and workplace terms</p>
                </div>
                <div class="theme-card" onclick="startQuiz('hobbies')">
                    <h3>üé® Hobbies & Activities</h3>
                    <p>Sports, entertainment, and leisure activities</p>
                </div>
                <div class="theme-card" onclick="startQuiz('directions')">
                    <h3>üß≠ Directions & Places</h3>
                    <p>Locations, directions, and navigating around town</p>
                </div>
                <div class="theme-card" onclick="startQuiz('emotions')">
                    <h3>üòä Emotions & Feelings</h3>
                    <p>Expressing feelings, emotions, and personal states</p>
                </div>
            </div>
            
            <div id="quiz-content" style="display: none;">
                <button class="btn" onclick="backToThemes()">‚Üê Back to Themes</button>
                <div id="quiz-questions"></div>
                <div class="score" id="quiz-score">Score: 0/0</div>
                    </div>
    </div>

    <!-- Daily Phrases Section -->
    <div id="phrases" class="section">
        <h2>üìÖ Malay Phrase of the Day</h2>
        <p class="subtitle">Learn essential Malay phrases organized by weekly themes</p>
        
        <div class="phrase-container">
            <div class="current-phrase">
                <div class="phrase-header">
                    <h3 id="phrase-title">üìÖ Today's Phrase</h3>
                    <div class="phrase-meta">
                        <span id="phrase-week">Week 1</span> ‚Ä¢ <span id="phrase-category">Greetings</span>
                    </div>
                </div>
                <div class="phrase-content">
                    <div class="phrase-malay" id="phrase-malay">Selamat pagi</div>
                    <div class="phrase-english" id="phrase-english">Good morning</div>
                    <button class="phrase-audio-btn" onclick="speakPhrase()">üîä Listen</button>
                </div>
            </div>
            
            <div class="phrase-navigation">
                <button class="nav-phrase-btn" onclick="previousPhrase()">‚Üê Previous Phrase</button>
                <button class="nav-phrase-btn" onclick="randomPhrase()">üé≤ Random Phrase</button>
                <button class="nav-phrase-btn" onclick="nextPhrase()">Next Phrase ‚Üí</button>
            </div>
        </div>
        
        <div class="week-selector">
            <h3>üìö Browse Other Weeks</h3>
            <div class="week-buttons">
                <button class="week-btn active" onclick="selectWeek(1)">Week 1<br><small>Survival Essentials</small></button>
                <button class="week-btn" onclick="selectWeek(2)">Week 2<br><small>Shopping & Directions</small></button>
                <button class="week-btn" onclick="selectWeek(3)">Week 3<br><small>Time & Daily Life</small></button>
                <button class="week-btn" onclick="selectWeek(4)">Week 4<br><small>Social & Emergencies</small></button>
                <button class="week-btn" onclick="selectWeek(5)">Week 5<br><small>Home & Community</small></button>
                <button class="week-btn" onclick="selectWeek(6)">Week 6<br><small>Workplace & Studies</small></button>
                <button class="week-btn" onclick="selectWeek(7)">Week 7<br><small>Culture & Media</small></button>
                <button class="week-btn" onclick="selectWeek(8)">Week 8<br><small>Advanced Scenarios</small></button>
            </div>
        </div>
        
        <div class="current-week-section">
            <h3 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">üìñ This Week's Complete Phrase Collection</h3>
            <div class="phrases-list" id="phrases-list">
                <!-- Phrases will be populated here -->
            </div>
        </div>
    </div>

 
    </div>
    
    <div class="input-container">
        <input type="text" id="messageInput" placeholder="Type your message in Malay..." 
               onkeypress="if(event.key==='Enter') sendMessage()">
        <button id="sendButton" onclick="sendMessage()">Hantar</button>
    </div>

    <script>
        let currentSection = 'home';
        let quizScore = 0;
        let quizTotal = 0;
        let currentQuiz = null;
        let currentTopic = null;
        let conversationStep = 0;
        let conversationContext = {};
        let currentPhraseIndex = 0;
        let currentWeek = 1;

        // Daily Phrases Data - 8 weeks of essential Malay phrases
        const phrasesData = {
            1: {
                title: "Survival Essentials & Greetings",
                categories: {
                    "Greetings": [
                        { malay: "Selamat pagi", english: "Good morning" },
                        { malay: "Apa khabar?", english: "How are you?" },
                        { malay: "Khabar baik", english: "I'm fine" },
                        { malay: "Terima kasih", english: "Thank you" },
                        { malay: "Sama-sama", english: "You're welcome" }
                    ],
                    "Food & Drinks": [
                        { malay: "Saya lapar", english: "I'm hungry" },
                        { malay: "Saya dahaga", english: "I'm thirsty" },
                        { malay: "Boleh saya lihat menu?", english: "Can I see the menu?" },
                        { malay: "Saya nak pesan...", english: "I want to order..." },
                        { malay: "Ada nasi ayam?", english: "Do you have chicken rice?" },
                        { malay: "Bilik air di mana?", english: "Where is the toilet?" }
                    ],
                    "Polite Requests": [
                        { malay: "Boleh tolong saya?", english: "Can you help me?" },
                        { malay: "Maaf", english: "Sorry/Excuse me" },
                        { malay: "Boleh...?", english: "Can I/May I...?" }
                    ]
                }
            },
            2: {
                title: "Shopping & Getting Around",
                categories: {
                    "Shopping": [
                        { malay: "Berapa harganya?", english: "How much is this?" },
                        { malay: "Mahal sangat!", english: "Too expensive!" },
                        { malay: "Ada diskaun?", english: "Is there a discount?" },
                        { malay: "Saya cuma tengok", english: "I'm just looking" },
                        { malay: "Boleh bayar dengan kad?", english: "Can I pay by card?" }
                    ],
                    "Directions": [
                        { malay: "Di mana stesen bas?", english: "Where is the bus station?" },
                        { malay: "Di mana stesen teksi?", english: "Where is the taxi station?" },
                        { malay: "Belok kiri", english: "Turn left" },
                        { malay: "Belok kanan", english: "Turn right" },
                        { malay: "Jalan terus", english: "Go straight" },
                        { malay: "Jauh ke...?", english: "Is it far to...?" },
                        { malay: "Saya sesat", english: "I'm lost" }
                    ],
                    "Transport": [
                        { malay: "Teksi!", english: "Taxi!" },
                        { malay: "Berapa tambang ke...?", english: "How much is the fare to...?" },
                        { malay: "Berhenti di sini", english: "Stop here" }
                    ]
                }
            },
            3: {
                title: "Time, Weather & Daily Life",
                categories: {
                    "Time & Dates": [
                        { malay: "Pukul berapa?", english: "What time is it?" },
                        { malay: "Hari ini hari apa?", english: "What day is today?" },
                        { malay: "Esok", english: "Tomorrow" },
                        { malay: "Semalam", english: "Yesterday" },
                        { malay: "Minggu depan", english: "Next week" },
                        { malay: "Minggu lepas", english: "Last week" }
                    ],
                    "Weather": [
                        { malay: "Hari ini panas", english: "Today is hot" },
                        { malay: "Hari ini hujan", english: "Today is rainy" },
                        { malay: "Ada ribut petir", english: "There's a thunderstorm" },
                        { malay: "Cuaca baik", english: "The weather is good" },
                        { malay: "Berapa suhu?", english: "What's the temperature?" }
                    ],
                    "Daily Activities": [
                        { malay: "Saya bangun pukul...", english: "I wake up at..." },
                        { malay: "Saya pergi kerja", english: "I go to work" },
                        { malay: "Saya bersenam", english: "I exercise" },
                        { malay: "Makan malam pukul lapan", english: "Dinner at 8 pm" }
                    ]
                }
            },
            4: {
                title: "Social Interactions & Emergencies",
                categories: {
                    "Socializing": [
                        { malay: "Awak berasal dari mana?", english: "Where are you from?" },
                        { malay: "Apa hobi awak?", english: "What's your hobby?" },
                        { malay: "Jumpa lagi!", english: "See you again!" },
                        { malay: "Boleh saya ambil gambar?", english: "Can I take a photo?" }
                    ],
                    "Feelings & Opinions": [
                        { malay: "Saya gembira", english: "I'm happy" },
                        { malay: "Saya sedih", english: "I'm sad" },
                        { malay: "Saya tak faham", english: "I don't understand" },
                        { malay: "Saya setuju", english: "I agree" },
                        { malay: "Tak setuju", english: "I disagree" },
                        { malay: "Awak pandai cakap Bahasa Melayu!", english: "You speak Malay well!" }
                    ],
                    "Health & Emergencies": [
                        { malay: "Saya tak sihat", english: "I'm unwell" },
                        { malay: "Saya demam", english: "I have fever" },
                        { malay: "Saya sakit perut", english: "I have stomachache" },
                        { malay: "Tolong panggil doktor!", english: "Please call a doctor!" },
                        { malay: "Di mana hospital terdekat?", english: "Where's the nearest hospital?" },
                        { malay: "Tolong!", english: "Help!" }
                    ]
                }
            },
            5: {
                title: "Home & Community",
                categories: {
                    "Housing": [
                        { malay: "Rumah sewa", english: "Rental house" },
                        { malay: "Bil elektrik", english: "Electricity bill" },
                        { malay: "Bil air", english: "Water bill" },
                        { malay: "Buang sampah hari apa?", english: "Which day is garbage collection?" },
                        { malay: "Paip rosak", english: "The pipe is leaking" }
                    ],
                    "Neighborhood": [
                        { malay: "Kami jiran baru", english: "We're new neighbors" },
                        { malay: "Ada kedai runcit berhampiran?", english: "Is there a grocery store nearby?" },
                        { malay: "Kawasan ini selamat?", english: "Is this area safe?" },
                        { malay: "Bising sikit pada waktu malam", english: "It's a bit noisy at night" }
                    ],
                    "Local Services": [
                        { malay: "Tolong panggil tukang elektrik", english: "Please call an electrician" },
                        { malay: "Pejabat pos di mana?", english: "Where's the post office?" },
                        { malay: "Ada menu penghantar makanan?", english: "Do you have a food delivery menu?" }
                    ]
                }
            },
            6: {
                title: "Workplace & Studies",
                categories: {
                    "Professional Phrases": [
                        { malay: "Boleh saya minta cuti?", english: "Can I request leave?" },
                        { malay: "Meeting bermula pukul berapa?", english: "What time does the meeting start?" },
                        { malay: "Fail ini untuk siapa?", english: "Who is this file for?" },
                        { malay: "Saya perlukan lebih masa", english: "I need more time" }
                    ],
                    "Campus/School": [
                        { malay: "Kuliah dibatalkan hari ini", english: "Lecture is canceled today" },
                        { malay: "Bila tarikh hantar kerja kursus?", english: "When is the assignment due?" },
                        { malay: "Perpustakaan buka hingga pukul berapa?", english: "Until when is the library open?" }
                    ],
                    "Networking": [
                        { malay: "Boleh saya ada kad nama awak?", english: "May I have your business card?" },
                        { malay: "Kita boleh berhubung melalui email", english: "We can connect via email" },
                        { malay: "Syarikat anda buat apa?", english: "What does your company do?" }
                    ]
                }
            },
            7: {
                title: "Culture & Media",
                categories: {
                    "Festivals/Traditions": [
                        { malay: "Apa maksud adat ini?", english: "What's the meaning of this custom?" },
                        { malay: "Selamat Hari Raya!", english: "Happy Eid!" },
                        { malay: "Selamat Aidilfitri!", english: "Happy Eid!" },
                        { malay: "Baju kurung", english: "Traditional Malay dress (female)" },
                        { malay: "Baju Melayu", english: "Traditional Malay attire (male)" },
                        { malay: "Boleh saya cuba makanan ini?", english: "Can I try this food?" }
                    ],
                    "Entertainment": [
                        { malay: "Filem tempatan yang best?", english: "Any good local movies?" },
                        { malay: "Konsert diadakan di mana?", english: "Where's the concert held?" },
                        { malay: "Lagu ni siapa nyanyi?", english: "Who sings this song?" }
                    ],
                    "Expressing Opinions": [
                        { malay: "Pada pendapat saya...", english: "In my opinion..." },
                        { malay: "Saya minat seni tempatan", english: "I'm interested in local art" },
                        { malay: "Tak berapa gemar", english: "I don't really like it" }
                    ]
                }
            },
            8: {
                title: "Advanced Scenarios & Troubleshooting",
                categories: {
                    "Tech Issues": [
                        { malay: "Wi-Fi tak berfungsi", english: "Wi-Fi isn't working" },
                        { malay: "Boleh reset kata laluan?", english: "Can you reset the password?" },
                        { malay: "Peranti tak boleh disambung", english: "Device won't connect" }
                    ],
                    "Complaints/Issues": [
                        { malay: "Pesanan saya salah", english: "My order is wrong" },
                        { malay: "Bilik hotel kotor", english: "The hotel room is dirty" },
                        { malay: "Saya nak buat aduan", english: "I want to make a complaint" }
                    ],
                    "Official Matters": [
                        { malay: "Dokumen untuk visa", english: "Documents for a visa" },
                        { malay: "Cara isi borang ini?", english: "How to fill this form?" },
                        { malay: "Pejabat imigresen dekat sini?", english: "Is the immigration office nearby?" }
                    ]
                }
            }
        };

        // Quiz data for all 14 themes
        const quizData = {
            greetings: [
                { question: "What does 'Terima kasih' mean?", options: ["Good morning", "Thank you", "Excuse me", "How are you"], correct: 1 },
                { question: "How do you say 'Good morning' in Malay?", options: ["Selamat malam", "Selamat petang", "Selamat pagi", "Selamat tengahari"], correct: 2 },
                { question: "What does 'Maaf' mean?", options: ["Sorry", "Please", "Welcome", "Goodbye"], correct: 0 },
                { question: "How do you say 'You're welcome'?", options: ["Terima kasih", "Sama-sama", "Maaf", "Selamat tinggal"], correct: 1 }
            ],
            family: [
                { question: "What does 'Ayah' mean?", options: ["Mother", "Father", "Brother", "Sister"], correct: 1 },
                { question: "How do you say 'older sister' in Malay?", options: ["Kakak", "Adik", "Ibu", "Nenek"], correct: 0 },
                { question: "What does 'Cucu' mean?", options: ["Child", "Grandchild", "Nephew", "Cousin"], correct: 1 },
                { question: "How do you say 'family' in Malay?", options: ["Rumah", "Keluarga", "Kawan", "Jiran"], correct: 1 }
            ],
            food: [
                { question: "What is 'Nasi lemak'?", options: ["Fried rice", "Coconut rice", "White rice", "Rice noodles"], correct: 1 },
                { question: "What does 'Minum' mean?", options: ["Eat", "Drink", "Cook", "Buy"], correct: 1 },
                { question: "What is 'Teh tarik'?", options: ["Coffee", "Pulled tea", "Ice cream", "Soup"], correct: 1 },
                { question: "What does 'Pedas' mean?", options: ["Sweet", "Sour", "Spicy", "Salty"], correct: 2 }
            ],
            transport: [
                { question: "What does 'Bas' mean?", options: ["Train", "Bus", "Car", "Bicycle"], correct: 1 },
                { question: "How do you say 'MRT station' in Malay?", options: ["Stesen bas", "Stesen MRT", "Lapangan terbang", "Pelabuhan"], correct: 1 },
                { question: "What does 'Teksi' mean?", options: ["Bus", "Train", "Taxi", "Motorcycle"], correct: 2 },
                { question: "How do you say 'airport' in Malay?", options: ["Stesen", "Lapangan terbang", "Pelabuhan", "Jalan raya"], correct: 1 }
            ],
            shopping: [
                { question: "What does 'Berapa harga?' mean?", options: ["What color?", "How much?", "Where is?", "What time?"], correct: 1 },
                { question: "How do you say 'cheap' in Malay?", options: ["Mahal", "Murah", "Besar", "Kecil"], correct: 1 },
                { question: "What does 'Beli' mean?", options: ["Sell", "Buy", "Look", "Want"], correct: 1 },
                { question: "How do you say 'expensive' in Malay?", options: ["Murah", "Cantik", "Mahal", "Bagus"], correct: 2 }
            ],
            numbers: [
                { question: "What is 'Lima' in English?", options: ["Three", "Four", "Five", "Six"], correct: 2 },
                { question: "How do you say '10' in Malay?", options: ["Sembilan", "Sepuluh", "Sebelas", "Lapan"], correct: 1 },
                { question: "What does 'Pukul berapa?' mean?", options: ["How many?", "What time?", "How much?", "Which day?"], correct: 1 },
                { question: "What is 'Satu' in English?", options: ["One", "Two", "Three", "Zero"], correct: 0 }
            ],
            body: [
                { question: "What does 'Kepala' mean?", options: ["Hand", "Head", "Foot", "Eye"], correct: 1 },
                { question: "How do you say 'sick' in Malay?", options: ["Sihat", "Sakit", "Penat", "Lapar"], correct: 1 },
                { question: "What does 'Mata' mean?", options: ["Nose", "Mouth", "Eye", "Ear"], correct: 2 },
                { question: "How do you say 'hand' in Malay?", options: ["Kaki", "Tangan", "Badan", "Muka"], correct: 1 }
            ],
            colors: [
                { question: "What does 'Merah' mean?", options: ["Blue", "Green", "Red", "Yellow"], correct: 2 },
                { question: "How do you say 'white' in Malay?", options: ["Hitam", "Putih", "Abu-abu", "Coklat"], correct: 1 },
                { question: "What does 'Besar' mean?", options: ["Small", "Big", "Long", "Short"], correct: 1 },
                { question: "How do you say 'beautiful' in Malay?", options: ["Hodoh", "Cantik", "Buruk", "Kotor"], correct: 1 }
            ],
            weather: [
                { question: "What does 'Hujan' mean?", options: ["Sun", "Rain", "Wind", "Cloud"], correct: 1 },
                { question: "How do you say 'hot' in Malay?", options: ["Sejuk", "Panas", "Basah", "Kering"], correct: 1 },
                { question: "What does 'Angin' mean?", options: ["Rain", "Sun", "Wind", "Storm"], correct: 2 },
                { question: "How do you say 'cold' in Malay?", options: ["Panas", "Sejuk", "Lembap", "Kering"], correct: 1 }
            ],
            home: [
                { question: "What does 'Rumah' mean?", options: ["Room", "House", "Kitchen", "Bathroom"], correct: 1 },
                { question: "How do you say 'bedroom' in Malay?", options: ["Dapur", "Bilik tidur", "Ruang tamu", "Bilik air"], correct: 1 },
                { question: "What does 'Katil' mean?", options: ["Chair", "Table", "Bed", "Door"], correct: 2 },
                { question: "How do you say 'kitchen' in Malay?", options: ["Dapur", "Bilik", "Tingkap", "Pintu"], correct: 0 }
            ],
            work: [
                { question: "What does 'Kerja' mean?", options: ["Study", "Work", "Play", "Sleep"], correct: 1 },
                { question: "How do you say 'teacher' in Malay?", options: ["Pelajar", "Cikgu", "Doktor", "Jurutera"], correct: 1 },
                { question: "What does 'Sekolah' mean?", options: ["Office", "Hospital", "School", "Shop"], correct: 2 },
                { question: "How do you say 'student' in Malay?", options: ["Cikgu", "Pelajar", "Pekerja", "Doktor"], correct: 1 }
            ],
            hobbies: [
                { question: "What does 'Bola sepak' mean?", options: ["Basketball", "Football", "Tennis", "Swimming"], correct: 1 },
                { question: "How do you say 'read' in Malay?", options: ["Tulis", "Baca", "Dengar", "Tengok"], correct: 1 },
                { question: "What does 'Lagu' mean?", options: ["Dance", "Song", "Movie", "Book"], correct: 1 },
                { question: "How do you say 'swim' in Malay?", options: ["Lari", "Berenang", "Lompat", "Berjalan"], correct: 1 }
            ],
            directions: [
                { question: "What does 'Kiri' mean?", options: ["Right", "Left", "Straight", "Back"], correct: 1 },
                { question: "How do you say 'near' in Malay?", options: ["Jauh", "Dekat", "Tinggi", "Rendah"], correct: 1 },
                { question: "What does 'Jalan' mean?", options: ["House", "Road", "Bridge", "Building"], correct: 1 },
                { question: "How do you say 'where is?' in Malay?", options: ["Bila?", "Apa?", "Kat mana?", "Kenapa?"], correct: 2 }
            ],
            emotions: [
                { question: "What does 'Gembira' mean?", options: ["Sad", "Angry", "Happy", "Tired"], correct: 2 },
                { question: "How do you say 'angry' in Malay?", options: ["Sedih", "Marah", "Takut", "Penat"], correct: 1 },
                { question: "What does 'Takut' mean?", options: ["Brave", "Scared", "Calm", "Excited"], correct: 1 },
                { question: "How do you say 'love' in Malay?", options: ["Benci", "Sayang", "Suka", "Rindu"], correct: 1 }
            ]
        };

        // Keyword detection patterns
        const keywords = {
            greetings: ['selamat', 'pagi', 'petang', 'malam', 'khabar', 'apa', 'hai', 'hello', 'terima kasih', 'thank you'],
            food: ['nasi', 'ayam', 'makan', 'minum', 'teh', 'kopi', 'char kway teow', 'laksa', 'roti', 'goreng', 'order', 'lapar'],
            shopping: ['beli', 'harga', 'berapa', 'murah', 'mahal', 'jual', 'kedai', 'pasar', 'kurang', 'bagi'],
            directions: ['mana', 'jalan', 'kiri', 'kanan', 'dekat', 'jauh', 'pergi', 'sampai', 'tengok'],
            numbers: ['satu', 'dua', 'tiga', 'empat', 'lima', 'enam', 'tujuh', 'lapan', 'sembilan', 'sepuluh'],
            help: ['tolong', 'bantu', 'help', 'tak faham', 'boleh', 'can'],
            family: ['ayah', 'ibu', 'anak', 'kakak', 'adik', 'nenek', 'datuk', 'keluarga', 'kahwin', 'isteri', 'suami'],
            work: ['kerja', 'office', 'gaji', 'cuti', 'boss', 'meeting', 'project', 'deadline', 'overtime'],
            health: ['sakit', 'demam', 'batuk', 'doktor', 'ubat', 'hospital', 'clinic', 'sihat', 'penat'],
            transport: ['mrt', 'bas', 'teksi', 'grab', 'stesen', 'tiket', 'ezlink', 'naik', 'turun'],
            weather: ['hujan', 'panas', 'sejuk', 'angin', 'mendung', 'cerah', 'ribut', 'cuaca'],
            hobbies: ['suka', 'hobby', 'baca', 'tengok', 'main', 'bola', 'music', 'lagu', 'filem'],
            school: ['sekolah', 'belajar', 'exam', 'homework', 'cikgu', 'pelajar', 'kelas', 'universiti'],
            time: ['masa', 'pukul', 'jam', 'hari', 'minggu', 'bulan', 'tahun', 'awal', 'lambat'],
            housing: ['rumah', 'sewa', 'rent', 'bilik', 'apartment', 'condo', 'flat', 'hdb'],
            banking: ['bank', 'akaun', 'account', 'money', 'exchange', 'tukar', 'wang', 'atm'],
            jobinterview: ['interview', 'kerja', 'job', 'experience', 'pengalaman', 'gaji', 'salary'],
            hotel: ['hotel', 'daftar', 'check-in', 'bilik', 'room', 'service', 'tetamu'],
            emergency: ['emergency', 'polis', 'police', 'hilang', 'lost', 'ambulans', 'urgent'],
            friends: ['kawan', 'friend', 'jemput', 'invite', 'jumpa', 'meet', 'berkawan'],
            postoffice: ['pos', 'post', 'hantar', 'send', 'bungkusan', 'package', 'setem'],
            cultural: ['kenduri', 'wedding', 'kahwin', 'festival', 'celebration', 'budaya']
        };

        // Extended conversation flow templates (5-7 interactions each)
        const conversationFlows = {
            greetings: [
                { malay: "Selamat datang! Apa khabar hari ini?", english: "Welcome! How are you today?" },
                { malay: "Alhamdulillah, saya sihat. Awak dari mana?", english: "Praise be to God, I'm healthy. Where are you from?" },
                { malay: "Wah, jauh juga! Dah lama duduk sini?", english: "Wow, quite far! Have you been living here long?" },
                { malay: "Bagus! Suka tak duduk kat Singapore?", english: "Great! Do you like living in Singapore?" },
                { malay: "Nak belajar Bahasa Melayu untuk apa?", english: "What do you want to learn Malay for?" },
                { malay: "Okay! Mari kita practice sekarang!", english: "Okay! Let's practice now!" },
                { malay: "Jom cuba conversation yang lain pula!", english: "Let's try another conversation!" }
            ],
            food: [
                { malay: "Selamat datang ke kedai makan! Nak order apa?", english: "Welcome to the food stall! What would you like to order?" },
                { malay: "Kami ada nasi ayam, char kway teow, laksa, dan mee goreng. Mana satu best?", english: "We have chicken rice, char kway teow, laksa, and fried noodles. Which one is the best?" },
                { malay: "Nasi ayam memang sedap! Nak yang biasa ke yang roasted?", english: "Chicken rice is really delicious! Want the regular or roasted?" },
                { malay: "Berapa banyak? Satu jer ke dua?", english: "How many? Just one or two?" },
                { malay: "Nak minuman? Teh tarik, kopi, atau air kosong?", english: "Want drinks? Teh tarik, coffee, or plain water?" },
                { malay: "Pedas tak apa? Saya letak chili sikit.", english: "Spicy is okay? I'll put a little chili." },
                { malay: "Okay, tunggu 10 minit ya. Nanti saya panggilkan nama awak.", english: "Okay, wait 10 minutes. I'll call your name later." }
            ],
            shopping: [
                { malay: "Selamat datang ke kedai! Cari apa hari ini?", english: "Welcome to the shop! What are you looking for today?" },
                { malay: "Oh, awak nak beli buah-buahan? Pisang, epal, oren semua ada.", english: "Oh, you want to buy fruits? Bananas, apples, oranges - we have everything." },
                { malay: "Pisang ni fresh, baru sampai pagi tadi. Berapa kilo nak?", english: "These bananas are fresh, just arrived this morning. How many kilos do you want?" },
                { malay: "Dua kilo? Okay. Harga biasa RM6, tapi saya bagi RM5 je.", english: "Two kilos? Okay. Normal price RM6, but I'll give you RM5." },
                { malay: "Nak beli apa lagi? Epal Australia ni manis tau.", english: "Want to buy anything else? These Australian apples are sweet." },
                { malay: "Total semua RM12. Awak bayar cash ke card?", english: "Total everything RM12. You pay cash or card?" },
                { malay: "Terima kasih! Datang lagi ya! Buah segar selalu ada.", english: "Thank you! Come again! We always have fresh fruits." }
            ],
            directions: [
                { malay: "Eh, awak nampak keliru. Nak pergi mana?", english: "Eh, you look confused. Where do you want to go?" },
                { malay: "Orchard Road? Wah, jauh sikit. Naik MRT lagi senang.", english: "Orchard Road? Wow, quite far. Taking MRT is easier." },
                { malay: "Dari sini jalan ke Bugis MRT, lepas tu naik Green Line.", english: "From here walk to Bugis MRT, then take the Green Line." },
                { malay: "Turun kat Somerset atau Orchard station. Somerset lagi dekat.", english: "Get off at Somerset or Orchard station. Somerset is closer." },
                { malay: "Keluar je dari station, awak dah nampak shopping mall.", english: "As soon as you exit the station, you'll see the shopping mall." },
                { malay: "Journey takes about 20 minutes. Jangan lupa bawa EZ-Link card!", english: "Journey takes about 20 minutes. Don't forget to bring your EZ-Link card!" },
                { malay: "Kalau sesat, tanya kat Information Counter. Diorang boleh tolong.", english: "If you get lost, ask at the Information Counter. They can help." }
            ],
            help: [
                { malay: "Jangan risau, saya boleh tolong awak!", english: "Don't worry, I can help you!" },
                { malay: "Apa yang awak tak faham? Pronunciation ke grammar?", english: "What don't you understand? Pronunciation or grammar?" },
                { malay: "Okay, cuba cakap perlahan-lahan. Saya akan dengar.", english: "Okay, try to speak slowly. I will listen." },
                { malay: "Bagus! Pronunciation awak dah better. Cuba lagi sekali.", english: "Good! Your pronunciation is getting better. Try once more." },
                { malay: "Perfect! Awak dah pandai. Nak belajar perkataan baru?", english: "Perfect! You're getting good. Want to learn new words?" },
                { malay: "Practice makes perfect. Cakap dengan orang Melayu selalu.", english: "Practice makes perfect. Speak with Malay people often." }
            ],
            family: [
                { malay: "Wah, awak ada keluarga besar ke?", english: "Wow, do you have a big family?" },
                { malay: "Berapa orang dalam keluarga awak?", english: "How many people are in your family?" },
                { malay: "Ada adik beradik? Awak anak sulung ke?", english: "Do you have siblings? Are you the eldest?" },
                { malay: "Keluarga awak tinggal dekat ke jauh?", english: "Does your family live nearby or far away?" },
                { malay: "Awak selalu balik rumah tengok family?", english: "Do you often go home to see your family?" },
                { malay: "Sweet! Family memang penting dalam budaya kita.", english: "Sweet! Family is really important in our culture." },
                { malay: "Jaga family baik-baik tau. Diorang sayang awak!", english: "Take good care of your family. They love you!" }
            ],
            work: [
                { malay: "Awak kerja kat mana? Office ke kedai?", english: "Where do you work? Office or shop?" },
                { malay: "Kerja awak best tak? Stress ke santai?", english: "Is your work good? Stressful or relaxed?" },
                { malay: "Pukul berapa awak start kerja pagi-pagi?", english: "What time do you start work in the morning?" },
                { malay: "Boss awak okay tak? Garang ke baik?", english: "Is your boss okay? Fierce or nice?" },
                { malay: "Gaji cukup untuk hidup kat Singapore?", english: "Is the salary enough to live in Singapore?" },
                { malay: "Ada cuti public holiday tak? Boleh rest?", english: "Do you have public holidays off? Can you rest?" },
                { malay: "Kerja kena balance dengan life. Jangan stress sangat!", english: "Work needs to be balanced with life. Don't stress too much!" }
            ],
            health: [
                { malay: "Awak nampak tak sihat hari ni. Apa jadi?", english: "You don't look well today. What happened?" },
                { malay: "Demam ke batuk? Dah berapa hari sakit?", english: "Fever or cough? How many days have you been sick?" },
                { malay: "Dah makan ubat? Atau nak pergi clinic?", english: "Have you taken medicine? Or do you want to go to the clinic?" },
                { malay: "Clinic mana yang dekat? Government ke private?", english: "Which clinic is nearby? Government or private?" },
                { malay: "Jangan lupa bawa IC dan insurance card.", english: "Don't forget to bring your IC and insurance card." },
                { malay: "Minum air banyak-banyak dan rehat cukup.", english: "Drink lots of water and get enough rest." },
                { malay: "Get well soon! Kesihatan tu penting sangat.", english: "Get well soon! Health is very important." }
            ],
            transport: [
                { malay: "Nak pergi mana? Naik apa hari ni?", english: "Where are you going? What transport are you taking today?" },
                { malay: "MRT lagi fast, tapi bas pun okay jugak.", english: "MRT is faster, but bus is also okay." },
                { malay: "EZ-Link card awak ada balance tak?", english: "Does your EZ-Link card have balance?" },
                { malay: "Kalau rush hour, memang jam. Better avoid.", english: "During rush hour, it's definitely jammed. Better avoid." },
                { malay: "Grab mahal sikit, tapi convenient especially kalau hujan.", english: "Grab is a bit expensive, but convenient especially when it's raining." },
                { malay: "Singapore transport system memang best. Very efficient!", english: "Singapore's transport system is really good. Very efficient!" },
                { malay: "Safe travels! Jangan lupa scan when naik dan turun.", english: "Safe travels! Don't forget to scan when getting on and off." }
            ],
            weather: [
                { malay: "Wah, panas gila hari ni! Awak rasa tak?", english: "Wow, it's crazy hot today! Don't you think so?" },
                { malay: "Nampak macam nak hujan. Bawa payung tak?", english: "Looks like it's going to rain. Did you bring an umbrella?" },
                { malay: "Singapore weather memang unpredictable. Hot then suddenly hujan.", english: "Singapore weather is really unpredictable. Hot then suddenly rain." },
                { malay: "Air-con mesti kena on 24/7. Electric bill naik!", english: "Air-con must be on 24/7. Electric bill goes up!" },
                { malay: "Musim tengkujuh ni, selalu ada thunderstorm.", english: "During monsoon season, there are often thunderstorms." },
                { malay: "Best time jalan-jalan evening time, not so hot.", english: "Best time to walk around is evening time, not so hot." },
                { malay: "Stay hydrated! Singapore weather boleh buat dehydrated.", english: "Stay hydrated! Singapore weather can make you dehydrated." }
            ],
            hobbies: [
                { malay: "Awak suka buat apa time free? Ada hobby?", english: "What do you like to do in your free time? Do you have hobbies?" },
                { malay: "Wah, interesting! Dah berapa lama minat benda tu?", english: "Wow, interesting! How long have you been interested in that?" },
                { malay: "Kat Singapore ada club atau group untuk hobby tu?", english: "Are there clubs or groups for that hobby in Singapore?" },
                { malay: "Weekend awak spend time buat hobby ke lepak dengan kawan?", english: "Do you spend weekends doing hobbies or hanging out with friends?" },
                { malay: "Hobby tu expensive tak? Kena spend banyak duit?", english: "Is that hobby expensive? Do you need to spend a lot of money?" },
                { malay: "Bagus la ada hobby! Better than staring at phone je.", english: "Good to have hobbies! Better than just staring at the phone." },
                { malay: "Maybe boleh ajar I someday. I nak belajar new things!", english: "Maybe you can teach me someday. I want to learn new things!" }
            ],
            school: [
                { malay: "Awak student ke working adult? Kat mana study?", english: "Are you a student or working adult? Where do you study?" },
                { malay: "Ambil course apa? Engineering, business, or arts?", english: "What course are you taking? Engineering, business, or arts?" },
                { malay: "Exam period stress tak? Banyak assignments?", english: "Is exam period stressful? Lots of assignments?" },
                { malay: "Lecturer okay tak? Garang ke understanding?", english: "Are the lecturers okay? Strict or understanding?" },
                { malay: "After graduate, nak kerja kat Singapore ke balik kampung?", english: "After graduation, want to work in Singapore or go back hometown?" },
                { malay: "Study group dengan classmates boleh help a lot!", english: "Study groups with classmates can help a lot!" },
                { malay: "All the best for your studies! Education is investment.", english: "All the best for your studies! Education is an investment." }
            ],
            time: [
                { malay: "Eh, pukul berapa sekarang? I lupa tengok jam.", english: "Eh, what time is it now? I forgot to check the time." },
                { malay: "Awak busy tak hari ni? Ada appointment?", english: "Are you busy today? Do you have appointments?" },
                { malay: "Weekend ni ada plan? Nak buat apa?", english: "Do you have plans this weekend? What do you want to do?" },
                { malay: "Time flies so fast! Dah almost end of month.", english: "Time flies so fast! It's almost the end of the month." },
                { malay: "Awak morning person ke night owl? Early bird?", english: "Are you a morning person or night owl? Early bird?" },
                { malay: "Singapore timing sama dengan Malaysia, senang la.", english: "Singapore timing is the same as Malaysia, easy." },
                { malay: "Time management penting, especially kat Singapore everything fast pace!", english: "Time management is important, especially in Singapore where everything is fast-paced!" }
            ],
            housing: [
                { malay: "Awak duduk kat mana? HDB, condo, or landed?", english: "Where do you live? HDB, condo, or landed property?" },
                { malay: "Sewa ke beli? Kat Singapore property mahal gila!", english: "Rent or buy? Property in Singapore is crazy expensive!" },
                { malay: "Berapa bilik? Sharing dengan housemates ke?", english: "How many rooms? Sharing with housemates?" },
                { malay: "Area awak convenient tak? Near MRT?", english: "Is your area convenient? Near MRT?" },
                { malay: "Landlord okay tak? Some can be very demanding.", english: "Is the landlord okay? Some can be very demanding." },
                { malay: "Utilities expensive tak? Aircon bill must be high!", english: "Are utilities expensive? Aircon bill must be high!" },
                { malay: "Singapore housing dream: own property. But so expensive!", english: "Singapore housing dream: own property. But so expensive!" }
            ],
            banking: [
                { malay: "Selamat pagi! Saya mahu buka akaun untuk anak saya.", english: "Good morning! I want to open an account for my child." },
                { malay: "Selamat pagi, Encik. Sila isi borang ini dahulu.", english: "Good morning, sir. Please fill out this form first." },
                { malay: "Terima kasih. Bolehkah saya tukar wang juga?", english: "Thank you. Can I also exchange money?" },
                { malay: "Boleh, Encik. Sila ke kaunter tiga untuk money exchange.", english: "Yes sir. Please go to counter three for money exchange." },
                { malay: "Berapa lama untuk process akaun baru?", english: "How long to process the new account?" },
                { malay: "Dalam masa seminggu, akaun awak akan aktif.", english: "Within a week, your account will be active." }
            ],
            jobinterview: [
                { malay: "Selamat pagi! Boleh perkenalkan diri?", english: "Good morning! Can you introduce yourself?" },
                { malay: "Nama saya Aminah. Saya rajin dan suka belajar.", english: "My name is Aminah. I am hardworking and like to learn." },
                { malay: "Bagus! Apa pengalaman kerja awak?", english: "Good! What is your work experience?" },
                { malay: "Saya pernah bantu di perpustakaan sekolah dan kerja part-time.", english: "I have helped at the school library and worked part-time." },
                { malay: "Kenapa awak berminat dengan jawatan ini?", english: "Why are you interested in this position?" },
                { malay: "Jangan lupa datang awal dan berpakaian kemas kalau dapat kerja.", english: "Don't forget to come early and dress neatly if you get the job." }
            ],
            hotel: [
                { malay: "Selamat petang! Saya mahu daftar masuk.", english: "Good afternoon! I want to check in." },
                { malay: "Selamat petang! Boleh beri kad pengenalan dan booking confirmation?", english: "Good afternoon! Can you give me your ID and booking confirmation?" },
                { malay: "Ada bilik dengan dua katil single?", english: "Do you have a room with two single beds?" },
                { malay: "Ada! Bilik 508. Nak pesan room service?", english: "Yes! Room 508. Want to order room service?" },
                { malay: "Ya, saya mahu nasi goreng dan teh tarik.", english: "Yes, I want fried rice and teh tarik." },
                { malay: "Akan dihantar ke bilik dalam 30 minit. Selamat berehat!", english: "Will be delivered to your room in 30 minutes. Have a good rest!" }
            ],
            emergency: [
                { malay: "Encik polis, anak saya hilang di pasar!", english: "Police officer, my child is lost in the market!" },
                { malay: "Jangan panik, Puan. Apa nama dan umur anak Puan?", english: "Don't panic, Madam. What is your child's name and age?" },
                { malay: "Nama dia Hafiz, umur tujuh tahun. Pakai baju merah.", english: "His name is Hafiz, seven years old. Wearing a red shirt." },
                { malay: "Okay, kami akan broadcast dan cari dia. Puan tunggu di sini.", english: "Okay, we will broadcast and search for him. You wait here." },
                { malay: "Terima kasih, Encik! Saya sangat risau.", english: "Thank you, sir! I am very worried." },
                { malay: "Insya-Allah jumpa. Ramai orang akan tolong cari.", english: "God willing we'll find him. Many people will help search." }
            ],
            friends: [
                { malay: "Hai! Nama saya Farah. Awak siapa?", english: "Hi! My name is Farah. Who are you?" },
                { malay: "Saya Nurul. Saya baru pindah ke area ni.", english: "I'm Nurul. I just moved to this area." },
                { malay: "Welcome! Jom main badminton di taman petang ini!", english: "Welcome! Let's play badminton at the park this evening!" },
                { malay: "Boleh! Pukul berapa? Ada racket extra tak?", english: "Can! What time? Do you have an extra racket?" },
                { malay: "Pukul lima okay? Ada, jangan risau.", english: "Five o'clock okay? Yes, don't worry." },
                { malay: "Perfect! Lepas main boleh minum teh tarik sekali.", english: "Perfect! After playing we can drink teh tarik together." }
            ],
            postoffice: [
                { malay: "Selamat pagi! Saya mahu hantar bungkusan ke Johor.", english: "Good morning! I want to send a package to Johor." },
                { malay: "Bungkusan apa ni? Boleh saya tengok isi kandungan?", english: "What package is this? Can I see the contents?" },
                { malay: "Baju dan makanan kering untuk family. Nak guna pos biasa atau ekspres?", english: "Clothes and dried food for family. Want to use regular or express post?" },
                { malay: "Pos ekspres lagi cepat. Berapa harganya?", english: "Express post is faster. How much does it cost?" },
                { malay: "RM15 untuk ekspres. Nak beli setem juga?", english: "RM15 for express. Want to buy stamps too?" },
                { malay: "Ya, lima setem biasa. Berapa hari sampai Johor?", english: "Yes, five regular stamps. How many days to reach Johor?" }
            ],
            cultural: [
                { malay: "Nenek, kenapa ramai orang hari ini?", english: "Grandmother, why are there so many people today?" },
                { malay: "Hari ini kenduri kahwin sepupu awak, Iqbal.", english: "Today is your cousin's wedding ceremony, Iqbal." },
                { malay: "Wah! Saya mahu beri salam dan hadiah.", english: "Wow! I want to give greetings and a gift." },
                { malay: "Bagus! Jangan lupa ucap 'Selamat Pengantin Baru'.", english: "Good! Don't forget to say 'Congratulations to the newlyweds'." },
                { malay: "Okay Nenek! Makanan apa ada hari ni?", english: "Okay Grandma! What food is there today?" },
                { malay: "Ada nasi minyak, rendang, dan kuih-muih tradisional.", english: "There's nasi minyak, rendang, and traditional cakes." }
            ]
        };

        // Learning progression responses
        const encouragementResponses = [
            { malay: "Bagus! Awak dah pandai!", english: "Good! You're getting better!" },
            { malay: "Betul! Teruskan belajar!", english: "Correct! Keep learning!" },
            { malay: "Hebat! Pronunciation awak bagus!", english: "Great! Your pronunciation is good!" },
            { malay: "Cuba lagi! Practice makes perfect!", english: "Try again! Practice makes perfect!" }
        ];

        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            // Show selected section
            document.getElementById(section).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            currentSection = section;
        }

        function startQuiz(theme) {
            currentQuiz = theme;
            quizScore = 0;
            quizTotal = 0;
            
            document.getElementById('quiz-themes').style.display = 'none';
            document.getElementById('quiz-content').style.display = 'block';
            
            const questionsContainer = document.getElementById('quiz-questions');
            questionsContainer.innerHTML = `<h3>üìö ${getThemeTitle(theme)}</h3>`;
            
            quizData[theme].forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'quiz-question';
                questionDiv.innerHTML = `
                    <h4>Question ${index + 1}: ${q.question}</h4>
                    <div class="quiz-options">
                        ${q.options.map((option, i) => 
                            `<button class="quiz-option" onclick="checkAnswer(this, ${i === q.correct}, ${index})">${option}</button>`
                        ).join('')}
                    </div>
                `;
                questionsContainer.appendChild(questionDiv);
            });
            
            updateQuizScore();
        }

        function getThemeTitle(theme) {
            const titles = {
                greetings: 'Greetings & Politeness',
                family: 'Family & Relationships',
                food: 'Food & Drinks',
                transport: 'Transportation',
                shopping: 'Shopping',
                numbers: 'Numbers & Time',
                body: 'Body & Health',
                colors: 'Colors & Descriptions',
                weather: 'Weather & Nature',
                home: 'Home & Living',
                work: 'Work & School',
                hobbies: 'Hobbies & Activities',
                directions: 'Directions & Places',
                emotions: 'Emotions & Feelings'
            };
            return titles[theme] || theme;
        }

        function checkAnswer(button, isCorrect, questionIndex) {
            quizTotal++;
            if (isCorrect) {
                button.style.background = '#FFD700'; // Yellow for correct answer
                button.style.color = '#000'; // Black text for better contrast on yellow
                quizScore++;
            } else {
                button.style.background = '#f44336'; // Red for wrong answer
                button.style.color = '#fff';
                // Highlight correct answer in yellow
                const options = button.parentElement.querySelectorAll('.quiz-option');
                const correctAnswer = quizData[currentQuiz][questionIndex].correct;
                options[correctAnswer].style.background = '#FFD700'; // Yellow for correct answer
                options[correctAnswer].style.color = '#000'; // Black text for better contrast
                options[correctAnswer].style.fontWeight = 'bold'; // Make it stand out more
            }
            
            // Disable all options for this question
            button.parentElement.querySelectorAll('.quiz-option').forEach(opt => {
                opt.disabled = true;
                opt.style.cursor = 'not-allowed';
            });
            
            updateQuizScore();
        }

        function updateQuizScore() {
            document.getElementById('quiz-score').textContent = `Score: ${quizScore}/${quizTotal}`;
        }

        function backToThemes() {
            document.getElementById('quiz-themes').style.display = 'grid';
            document.getElementById('quiz-content').style.display = 'none';
            currentQuiz = null;
        }

        // Chat functions
        function addMessage(text, isUser, english = null) {
            const chatContainer = document.getElementById('chat-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            messageDiv.innerHTML = text;
            
            if (english && !isUser) {
                const bilingualDiv = document.createElement('div');
                bilingualDiv.className = 'bilingual';
                bilingualDiv.textContent = english;
                messageDiv.appendChild(bilingualDiv);
            }
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            if (message && currentSection === 'chat') {
                addMessage(message, true);
                input.value = '';
                
                setTimeout(() => {
                    const response = getContextualResponse(message);
                    addMessage(response.malay, false, response.english);
                }, 1000);
            }
        }

        function sendQuickReply(malay, english) {
            if (currentSection === 'chat') {
                addMessage(malay, true);
                setTimeout(() => {
                    const response = getContextualResponse(malay);
                    addMessage(response.malay, false, response.english);
                }, 1000);
            }
        }

        function detectTopic(message) {
            const lowerMessage = message.toLowerCase();
            
            for (const [topic, keywordList] of Object.entries(keywords)) {
                for (const keyword of keywordList) {
                    if (lowerMessage.includes(keyword)) {
                        return topic;
                    }
                }
            }
            return 'general';
        }

        function getContextualResponse(userMessage) {
            const detectedTopic = detectTopic(userMessage);
            
            // If we detect a new topic, switch to it
            if (detectedTopic !== 'general' && detectedTopic !== currentTopic) {
                currentTopic = detectedTopic;
                conversationStep = 0;
            }
            
            // If we're in a topic conversation, continue the flow
            if (currentTopic && conversationFlows[currentTopic]) {
                const responses = conversationFlows[currentTopic];
                
                // Continue conversation flow if within range
                if (conversationStep < responses.length) {
                    const response = responses[conversationStep];
                    conversationStep++;
                    return response;
                }
                
                // After completing the flow, give encouragement and suggest new topics
                if (conversationStep === responses.length) {
                    conversationStep++;
                    const encouragement = encouragementResponses[Math.floor(Math.random() * encouragementResponses.length)];
                    return encouragement;
                }
                
                // After encouragement, cycle back or suggest new conversation
                if (conversationStep > responses.length) {
                    const followUp = [
                        { malay: "Nak practice topic lain? Cuba click button di bawah!", english: "Want to practice another topic? Try clicking the buttons below!" },
                        { malay: "Awak dah pandai! Mari cuba conversation baru!", english: "You're getting good! Let's try a new conversation!" },
                        { malay: "Hebat! Sekarang cuba roleplay scenario pulak!", english: "Great! Now try the roleplay scenarios!" }
                    ];
                    return followUp[Math.floor(Math.random() * followUp.length)];
                }
            }
            
            // Fallback to general helpful responses
            return getGeneralResponse(userMessage);
        }

        function getGeneralResponse(message) {
            const generalResponses = [
                { malay: "Maaf, saya tak faham. Boleh repeat?", english: "Sorry, I don't understand. Can you repeat?" },
                { malay: "Cuba cakap dalam Bahasa Melayu.", english: "Try speaking in Malay." },
                { malay: "Saya nak tolong awak belajar! Apa topic yang awak nak?", english: "I want to help you learn! What topic do you want?" },
                { malay: "Mari cuba conversation lain! Selamat pagi!", english: "Let's try another conversation! Good morning!" }
            ];
            
            return generalResponses[Math.floor(Math.random() * generalResponses.length)];
        }

        function resetConversation() {
            currentTopic = null;
            conversationStep = 0;
            conversationContext = {};
        }

        function startTopicConversation(topic) {
            currentTopic = topic;
            conversationStep = 0;
            
            if (conversationFlows[topic]) {
                const firstResponse = conversationFlows[topic][0];
                addMessage(firstResponse.malay, false, firstResponse.english);
                conversationStep = 1;
            }
        }

        function updateQuickReplies() {
            // Cycle through different topic sets
            const quickRepliesContainer = document.querySelector('.quick-replies');
            const currentButtons = quickRepliesContainer.innerHTML;
            
            if (currentButtons.includes('Transport')) {
                // Show set 2: More topics  
                quickRepliesContainer.innerHTML = `
                    <button class="quick-reply" onclick="startTopicConversation('health')">üè• Health</button>
                    <button class="quick-reply" onclick="startTopicConversation('school')">üéì School</button>
                    <button class="quick-reply" onclick="startTopicConversation('time')">‚è∞ Time</button>
                    <button class="quick-reply" onclick="startTopicConversation('housing')">üè† Housing</button>
                    <button class="quick-reply" onclick="startTopicConversation('directions')">üß≠ Directions</button>
                    <button class="quick-reply" onclick="startTopicConversation('help')">üÜò Help</button>
                    <button class="quick-reply" onclick="resetConversation(); updateQuickReplies()">üé≠ Role-Play</button>
                `;
            } else if (currentButtons.includes('Banking')) {
                // Show set 1: Main topics
                quickRepliesContainer.innerHTML = `
                    <button class="quick-reply" onclick="startTopicConversation('greetings')">ü§ù Greetings</button>
                    <button class="quick-reply" onclick="startTopicConversation('food')">üçú Food</button>
                    <button class="quick-reply" onclick="startTopicConversation('shopping')">üõí Shopping</button>
                    <button class="quick-reply" onclick="startTopicConversation('transport')">üöá Transport</button>
                    <button class="quick-reply" onclick="startTopicConversation('work')">üíº Work</button>
                    <button class="quick-reply" onclick="startTopicConversation('family')">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family</button>
                    <button class="quick-reply" onclick="startTopicConversation('weather')">üå¶Ô∏è Weather</button>
                    <button class="quick-reply" onclick="startTopicConversation('hobbies')">üé® Hobbies</button>
                    <button class="quick-reply" onclick="resetConversation(); updateQuickReplies()">üîÑ More Topics</button>
                `;
            } else {
                // Show set 3: Role-Playing scenarios
                quickRepliesContainer.innerHTML = `
                    <button class="quick-reply" onclick="startTopicConversation('banking')">üè¶ Banking</button>
                    <button class="quick-reply" onclick="startTopicConversation('jobinterview')">üíº Job Interview</button>
                    <button class="quick-reply" onclick="startTopicConversation('hotel')">üè® Hotel</button>
                    <button class="quick-reply" onclick="startTopicConversation('emergency')">üö® Emergency</button>
                    <button class="quick-reply" onclick="startTopicConversation('friends')">üë´ Making Friends</button>
                    <button class="quick-reply" onclick="startTopicConversation('postoffice')">üìÆ Post Office</button>
                    <button class="quick-reply" onclick="startTopicConversation('cultural')">üéä Cultural Events</button>
                    <button class="quick-reply" onclick="resetConversation(); updateQuickReplies()">üîÑ Main Topics</button>
                `;
            }
        }

        function startRoleplay(scenario) {
            showSection('chat');
            
            const scenarios = {
                food: { malay: "Selamat datang! Nak order apa?", english: "Welcome! What would you like to order?" },
                shopping: { malay: "Nak beli apa hari ni?", english: "What would you like to buy today?" },
                directions: { malay: "Boleh saya tolong?", english: "Can I help you?" },
                clinic: { malay: "Apa masalah awak hari ni?", english: "What's your problem today?" },
                shop: { malay: "Cari apa, bang?", english: "What are you looking for, bro?" },
                bank: { malay: "Selamat pagi. Saya mahu buka akaun untuk anak saya.", english: "Good morning. I want to open an account for my child." },
                jobinterview: { malay: "Boleh perkenalkan diri?", english: "Can I introduce myself?" },
                hotel: { malay: "Selamat petang. Saya mahu daftar masuk.", english: "Good afternoon. I want to check in." },
                emergency: { malay: "Encik, anak saya hilang di pasar.", english: "Sir, my child is lost in the market." },
                friends: { malay: "Hai, nama saya Farah. Awak siapa?", english: "Hi, my name is Farah. Who are you?" },
                postoffice: { malay: "Saya mahu hantar bungkusan ke Johor.", english: "I want to send a package to Johor." },
                housing: { malay: "Saya mahu lihat rumah sewa tiga bilik.", english: "I want to view a three-room rental house." },
                cultural: { malay: "Nenek, kenapa ramai orang hari ini?", english: "Grandmother, why are there so many people today?" }
            };
            
            // Clear chat and start scenario
            document.getElementById('chat-container').innerHTML = '';
            const intro = scenarios[scenario];
            addMessage(intro.malay, false, intro.english);
        }

        // Daily Phrases Functions
        function getAllPhrases() {
            let allPhrases = [];
            for (let week in phrasesData) {
                for (let category in phrasesData[week].categories) {
                    phrasesData[week].categories[category].forEach(phrase => {
                        allPhrases.push({
                            ...phrase,
                            week: parseInt(week),
                            category: category,
                            weekTitle: phrasesData[week].title
                        });
                    });
                }
            }
            return allPhrases;
        }

        function updateCurrentPhrase() {
            const allPhrases = getAllPhrases();
            const phrase = allPhrases[currentPhraseIndex];
            
            document.getElementById('phrase-malay').textContent = phrase.malay;
            document.getElementById('phrase-english').textContent = phrase.english;
            document.getElementById('phrase-week').textContent = `Week ${phrase.week}`;
            document.getElementById('phrase-category').textContent = phrase.category;
        }

        function nextPhrase() {
            const allPhrases = getAllPhrases();
            currentPhraseIndex = (currentPhraseIndex + 1) % allPhrases.length;
            updateCurrentPhrase();
        }

        function previousPhrase() {
            const allPhrases = getAllPhrases();
            currentPhraseIndex = currentPhraseIndex === 0 ? allPhrases.length - 1 : currentPhraseIndex - 1;
            updateCurrentPhrase();
        }

        function randomPhrase() {
            const allPhrases = getAllPhrases();
            currentPhraseIndex = Math.floor(Math.random() * allPhrases.length);
            updateCurrentPhrase();
        }

        function speakPhrase() {
            const phraseText = document.getElementById('phrase-malay').textContent;
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(phraseText);
                utterance.lang = 'ms-MY'; // Malay language
                utterance.rate = 0.8; // Slightly slower for learning
                speechSynthesis.speak(utterance);
            }
        }

        function selectWeek(weekNum) {
            currentWeek = weekNum;
            
            // Update active week button
            document.querySelectorAll('.week-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.week-btn')[weekNum - 1].classList.add('active');
            
            // Display phrases for selected week
            displayWeekPhrases(weekNum);
        }

        function displayWeekPhrases(weekNum) {
            const weekData = phrasesData[weekNum];
            const phrasesList = document.getElementById('phrases-list');
            
            let html = `<h3 style="grid-column: 1/-1; text-align: center; color: #2c3e50; margin-bottom: 20px;">
                Week ${weekNum}: ${weekData.title}
            </h3>`;
            
            for (let category in weekData.categories) {
                weekData.categories[category].forEach(phrase => {
                    html += `
                        <div class="phrase-card">
                            <div class="phrase-card-category">${category}</div>
                            <div class="phrase-card-malay">${phrase.malay}</div>
                            <div class="phrase-card-english">${phrase.english}</div>
                            <button class="phrase-card-btn" onclick="speakText('${phrase.malay}')">üîä Listen</button>
                        </div>
                    `;
                });
            }
            
            phrasesList.innerHTML = html;
        }

        function getTodaysWeek() {
            // Get current day of year and cycle through weeks 1-8
            const now = new Date();
            const start = new Date(now.getFullYear(), 0, 0);
            const diff = now - start;
            const dayOfYear = Math.floor(diff / (1000 * 60 * 60 * 24));
            return ((Math.floor(dayOfYear / 7) % 8) + 1);
        }

        function getTodaysPhraseIndex() {
            // Get a consistent phrase for today based on date
            const now = new Date();
            const dayOfYear = now.getDate() + (now.getMonth() * 31);
            const allPhrases = getAllPhrases();
            return dayOfYear % allPhrases.length;
        }

        function speakText(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ms-MY';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        function initializePhrases() {
            // Set today's phrase automatically
            currentPhraseIndex = getTodaysPhraseIndex();
            updateCurrentPhrase();
            
            // Set current week and display only that week's phrases
            const todaysWeek = getTodaysWeek();
            currentWeek = todaysWeek;
            selectWeek(todaysWeek);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showSection('home');
            initializePhrases();
        });
    </script>
</body>
</html>