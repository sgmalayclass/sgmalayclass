<!DOCTYPE html>
<!-- Updated: 2025-01-27 - All features now working -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maya - Interactive Malay Learning Chatbot</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            text-align: center;
            color: #2E7D32;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .header p {
            font-size: 14px;
            color: #666;
        }
        .nav-menu {
            background: rgba(255,255,255,0.9);
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .nav-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        .nav-btn:hover, .nav-btn.active {
            background: #2E7D32;
        }
        .content-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        .section {
            display: none;
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .section.active {
            display: block;
        }
        .section h2 {
            color: #2E7D32;
            margin-bottom: 15px;
        }
        .quiz-themes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .theme-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        .theme-card:hover {
            border-color: #4CAF50;
            transform: translateY(-2px);
        }
        .theme-card h3 {
            color: #2E7D32;
            font-size: 16px;
            margin-bottom: 8px;
        }
        .theme-card p {
            color: #666;
            font-size: 14px;
        }
        .quiz-question {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .quiz-options {
            display: grid;
            gap: 8px;
            margin-top: 10px;
        }
        .quiz-option {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
        }
        .quiz-option:hover {
            background: #2E7D32;
        }
        .quiz-option:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .score {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #4CAF50;
            margin: 20px 0;
        }
        .chat-container {
            max-height: 400px;
            overflow-y: auto;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            word-wrap: break-word;
        }
        .user-message {
            background: #4CAF50;
            color: white;
            margin-left: auto;
        }
        .bot-message {
            background: rgba(255,255,255,0.95);
            color: #2E7D32;
        }
        .bilingual {
            font-style: italic;
            opacity: 0.8;
            font-size: 0.9em;
            margin-top: 5px;
        }
        .input-container {
            background: rgba(255,255,255,0.9);
            padding: 15px;
            display: flex;
            gap: 10px;
        }
        #messageInput {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
            font-size: 16px;
        }
        #sendButton {
            padding: 12px 24px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
        }
        .quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }
        .quick-reply {
            background: rgba(255,255,255,0.8);
            color: #2E7D32;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
        }
        .roleplay-scenarios {
            display: grid;
            gap: 15px;
        }
        .scenario-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            margin: 5px;
        }
        .btn:hover {
            background: #2E7D32;
        }
        .dialogue-preview {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 3px solid #4CAF50;
        }
        .dialogue-preview p {
            margin: 5px 0;
            color: #2E7D32;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üá∏üá¨ Maya - Interactive Malay Learning Chatbot</h1>
        <p>Learn Singapore Malay through conversation, quizzes, and role-playing scenarios</p>
    </div>
    
    <div class="nav-menu">
        <button class="nav-btn active" onclick="showSection('home')">Home</button>
        <button class="nav-btn" onclick="showSection('chat')">Chat</button>
        <button class="nav-btn" onclick="showSection('quiz')">Quiz</button>
        <button class="nav-btn" onclick="showSection('roleplay')">Role-Play</button>
    </div>
    
    <div class="content-area">
        <!-- Home Section -->
        <div class="section active" id="home">
            <h2>Welcome to Maya! üåü</h2>
            <p><strong>What is Maya?</strong><br>
            Maya is your friendly Singapore Malay learning companion! Practice conversational Malay, test your knowledge with quizzes, and engage in real-life scenarios.</p>
            
            <p><strong>Features:</strong><br>
            üó£Ô∏è <strong>Interactive Chat:</strong> Practice Malay conversations with English translations<br>
            üß† <strong>Knowledge Quiz:</strong> Test your vocabulary and grammar across 14 different themes<br>
            üé≠ <strong>Role-Playing:</strong> Practice real-life scenarios like ordering food, shopping, and more<br>
            üåç <strong>Singapore Context:</strong> Learn authentic Singapore Malay expressions</p>
            
            <p><strong>How to use:</strong><br>
            Click on the tabs above to navigate between different learning modes. Start with Chat to practice basic conversations!</p>
        </div>

        <!-- Chat Section -->
        <div class="section" id="chat">
            <h2>üí¨ Chat with Maya</h2>
            <div class="chat-container" id="chat-container">
                <div class="message bot-message">
                    Selamat datang! Saya Maya. Mari bercakap dalam Bahasa Melayu! üòä
                    <div class="bilingual">Welcome! I'm Maya. Let's chat in Malay!</div>
                </div>
            </div>
            
            <div class="quick-replies">
                <button class="quick-reply" onclick="startTopicConversation('greetings')">ü§ù Greetings</button>
                <button class="quick-reply" onclick="startTopicConversation('food')">üçú Food Ordering</button>
                <button class="quick-reply" onclick="startTopicConversation('shopping')">üõí Shopping</button>
                <button class="quick-reply" onclick="startTopicConversation('directions')">üß≠ Directions</button>
                <button class="quick-reply" onclick="resetConversation(); updateQuickReplies()">üîÑ New Topic</button>
            </div>
        </div>

        <!-- Quiz Section -->
        <div class="section" id="quiz">
            <h2>üß† Malay Quiz - Choose Your Theme</h2>
            <div class="quiz-themes" id="quiz-themes">
                <div class="theme-card" onclick="startQuiz('greetings')">
                    <h3>ü§ù Greetings & Politeness</h3>
                    <p>Basic greetings, please, thank you, and polite expressions</p>
                </div>
                <div class="theme-card" onclick="startQuiz('family')">
                    <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family & Relationships</h3>
                    <p>Family members, relationships, and personal connections</p>
                </div>
                <div class="theme-card" onclick="startQuiz('food')">
                    <h3>üçú Food & Drinks</h3>
                    <p>Hawker center favorites, local dishes, and beverages</p>
                </div>
                <div class="theme-card" onclick="startQuiz('transport')">
                    <h3>üöá Transportation</h3>
                    <p>MRT, buses, taxis, and getting around Singapore</p>
                </div>
                <div class="theme-card" onclick="startQuiz('shopping')">
                    <h3>üõí Shopping</h3>
                    <p>Markets, malls, bargaining, and making purchases</p>
                </div>
                <div class="theme-card" onclick="startQuiz('numbers')">
                    <h3>üî¢ Numbers & Time</h3>
                    <p>Counting, telling time, dates, and quantities</p>
                </div>
                <div class="theme-card" onclick="startQuiz('body')">
                    <h3>üè• Body & Health</h3>
                    <p>Body parts, health conditions, and medical terms</p>
                </div>
                <div class="theme-card" onclick="startQuiz('colors')">
                    <h3>üåà Colors & Descriptions</h3>
                    <p>Colors, sizes, shapes, and descriptive words</p>
                </div>
                <div class="theme-card" onclick="startQuiz('weather')">
                    <h3>üå¶Ô∏è Weather & Nature</h3>
                    <p>Weather conditions, seasons, and natural elements</p>
                </div>
                <div class="theme-card" onclick="startQuiz('home')">
                    <h3>üè† Home & Living</h3>
                    <p>House parts, furniture, and household items</p>
                </div>
                <div class="theme-card" onclick="startQuiz('work')">
                    <h3>üíº Work & School</h3>
                    <p>Occupations, school subjects, and workplace terms</p>
                </div>
                <div class="theme-card" onclick="startQuiz('hobbies')">
                    <h3>üé® Hobbies & Activities</h3>
                    <p>Sports, entertainment, and leisure activities</p>
                </div>
                <div class="theme-card" onclick="startQuiz('directions')">
                    <h3>üß≠ Directions & Places</h3>
                    <p>Locations, directions, and navigating around town</p>
                </div>
                <div class="theme-card" onclick="startQuiz('emotions')">
                    <h3>üòä Emotions & Feelings</h3>
                    <p>Expressing feelings, emotions, and personal states</p>
                </div>
            </div>
            
            <div id="quiz-content" style="display: none;">
                <button class="btn" onclick="backToThemes()">‚Üê Back to Themes</button>
                <div id="quiz-questions"></div>
                <div class="score" id="quiz-score">Score: 0/0</div>
            </div>
        </div>

        <!-- Role-Play Section -->
        <div class="section" id="roleplay">
            <h2>üé≠ Role-Playing Scenarios</h2>
            <p>Practice real-life Singapore/Malaysian situations with authentic dialogues!</p>
            
            <div class="roleplay-scenarios">
                <div class="scenario-card">
                    <h3>üçú Ordering Food at Hawker Center</h3>
                    <p><strong>Situation:</strong> You're at Maxwell Food Centre and want to order chicken rice.</p>
                    <button class="btn" onclick="startRoleplay('food')">Start Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h3>üõí Shopping at Wet Market</h3>
                    <p><strong>Situation:</strong> You're buying fresh fruits at Tekka Market.</p>
                    <button class="btn" onclick="startRoleplay('shopping')">Start Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h3>üöá Asking for Directions</h3>
                    <p><strong>Situation:</strong> You're lost and need to get to Orchard Road.</p>
                    <button class="btn" onclick="startRoleplay('directions')">Start Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h3>üè• At the Clinic</h3>
                    <p><strong>Situation:</strong> You're not feeling well and visiting a local clinic.</p>
                    <button class="btn" onclick="startRoleplay('clinic')">Start Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h3>üè™ At the Mama Shop</h3>
                    <p><strong>Situation:</strong> You need to buy some daily necessities from the neighborhood shop.</p>
                    <button class="btn" onclick="startRoleplay('shop')">Start Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h3>üè¶ At the Bank (Opening Account, Money Exchange)</h3>
                    <p><strong>Characters:</strong> Encik Rahman (father) and Bank Officer</p>
                    <div class="dialogue-preview">
                        <p><em>"Selamat pagi. Saya mahu buka akaun untuk anak saya."</em></p>
                        <p><em>"Selamat pagi. Sila isi borang ini."</em></p>
                    </div>
                    <button class="btn" onclick="startRoleplay('bank')">Start Banking Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h3>üíº Job Interview (Common Questions, Workplace Etiquette)</h3>
                    <p><strong>Characters:</strong> New Worker and Manager</p>
                    <div class="dialogue-preview">
                        <p><em>"Boleh perkenalkan diri?"</em></p>
                        <p><em>"Nama saya Aminah. Saya rajin dan suka belajar."</em></p>
                    </div>
                    <button class="btn" onclick="startRoleplay('jobinterview')">Start Interview Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h3>üè® At the Hotel (Check-in, Room Service, Complaints)</h3>
                    <p><strong>Characters:</strong> Guest and Receptionist</p>
                    <div class="dialogue-preview">
                        <p><em>"Selamat petang. Saya mahu daftar masuk."</em></p>
                        <p><em>"Boleh. Sila beri kad pengenalan."</em></p>
                    </div>
                    <button class="btn" onclick="startRoleplay('hotel')">Start Hotel Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h3>üö® Emergency Situations (Police, Ambulance, Reporting Incidents)</h3>
                    <p><strong>Characters:</strong> Mother and Police Officer</p>
                    <div class="dialogue-preview">
                        <p><em>"Encik, anak saya hilang di pasar."</em></p>
                        <p><em>"Apa nama dan umur anak puan?"</em></p>
                    </div>
                    <button class="btn" onclick="startRoleplay('emergency')">Start Emergency Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h3>ü§ù Making Friends (Introductions, Inviting to Events)</h3>
                    <p><strong>Characters:</strong> Farah and Nurul</p>
                    <div class="dialogue-preview">
                        <p><em>"Hai, nama saya Farah. Awak siapa?"</em></p>
                        <p><em>"Saya Nurul. Saya baru pindah ke sini."</em></p>
                    </div>
                    <button class="btn" onclick="startRoleplay('friends')">Start Friendship Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h3>‚úâÔ∏è At the Post Office (Sending Packages, Buying Stamps)</h3>
                    <p><strong>Characters:</strong> Mak Cik and Post Office Clerk</p>
                    <div class="dialogue-preview">
                        <p><em>"Saya mahu hantar bungkusan ke Johor."</em></p>
                        <p><em>"Nak guna pos biasa atau ekspres?"</em></p>
                    </div>
                    <button class="btn" onclick="startRoleplay('postoffice')">Start Post Office Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h3>üè† Rental/Housing (Viewing Apartments, Negotiating Rent)</h3>
                    <p><strong>Characters:</strong> Pak Cik and House Agent</p>
                    <div class="dialogue-preview">
                        <p><em>"Saya mahu lihat rumah sewa tiga bilik."</em></p>
                        <p><em>"Ini rumahnya. Ada ruang tamu luas."</em></p>
                    </div>
                    <button class="btn" onclick="startRoleplay('housing')">Start Housing Scenario</button>
                </div>
                
                <div class="scenario-card">
                    <h3>üéä Cultural Events (Weddings, Festivals, Religious Ceremonies)</h3>
                    <p><strong>Characters:</strong> Iqbal and Nenek (Grandmother)</p>
                    <div class="dialogue-preview">
                        <p><em>"Nenek, kenapa ramai orang hari ini?"</em></p>
                        <p><em>"Hari ini kenduri kahwin sepupu kamu."</em></p>
                    </div>
                    <button class="btn" onclick="startRoleplay('cultural')">Start Cultural Scenario</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="input-container">
        <input type="text" id="messageInput" placeholder="Type your message in Malay..." 
               onkeypress="if(event.key==='Enter') sendMessage()">
        <button id="sendButton" onclick="sendMessage()">Hantar</button>
    </div>

    <script>
        let currentSection = 'home';
        let quizScore = 0;
        let quizTotal = 0;
        let currentQuiz = null;
        let currentTopic = null;
        let conversationStep = 0;
        let conversationContext = {};

        // Quiz data for all 14 themes
        const quizData = {
            greetings: [
                { question: "What does 'Terima kasih' mean?", options: ["Good morning", "Thank you", "Excuse me", "How are you"], correct: 1 },
                { question: "How do you say 'Good morning' in Malay?", options: ["Selamat malam", "Selamat petang", "Selamat pagi", "Selamat tengahari"], correct: 2 },
                { question: "What does 'Maaf' mean?", options: ["Sorry", "Please", "Welcome", "Goodbye"], correct: 0 },
                { question: "How do you say 'You're welcome'?", options: ["Terima kasih", "Sama-sama", "Maaf", "Selamat tinggal"], correct: 1 }
            ],
            family: [
                { question: "What does 'Ayah' mean?", options: ["Mother", "Father", "Brother", "Sister"], correct: 1 },
                { question: "How do you say 'older sister' in Malay?", options: ["Kakak", "Adik", "Ibu", "Nenek"], correct: 0 },
                { question: "What does 'Cucu' mean?", options: ["Child", "Grandchild", "Nephew", "Cousin"], correct: 1 },
                { question: "How do you say 'family' in Malay?", options: ["Rumah", "Keluarga", "Kawan", "Jiran"], correct: 1 }
            ],
            food: [
                { question: "What is 'Nasi lemak'?", options: ["Fried rice", "Coconut rice", "White rice", "Rice noodles"], correct: 1 },
                { question: "What does 'Minum' mean?", options: ["Eat", "Drink", "Cook", "Buy"], correct: 1 },
                { question: "What is 'Teh tarik'?", options: ["Coffee", "Pulled tea", "Ice cream", "Soup"], correct: 1 },
                { question: "What does 'Pedas' mean?", options: ["Sweet", "Sour", "Spicy", "Salty"], correct: 2 }
            ],
            transport: [
                { question: "What does 'Bas' mean?", options: ["Train", "Bus", "Car", "Bicycle"], correct: 1 },
                { question: "How do you say 'MRT station' in Malay?", options: ["Stesen bas", "Stesen MRT", "Lapangan terbang", "Pelabuhan"], correct: 1 },
                { question: "What does 'Teksi' mean?", options: ["Bus", "Train", "Taxi", "Motorcycle"], correct: 2 },
                { question: "How do you say 'airport' in Malay?", options: ["Stesen", "Lapangan terbang", "Pelabuhan", "Jalan raya"], correct: 1 }
            ],
            shopping: [
                { question: "What does 'Berapa harga?' mean?", options: ["What color?", "How much?", "Where is?", "What time?"], correct: 1 },
                { question: "How do you say 'cheap' in Malay?", options: ["Mahal", "Murah", "Besar", "Kecil"], correct: 1 },
                { question: "What does 'Beli' mean?", options: ["Sell", "Buy", "Look", "Want"], correct: 1 },
                { question: "How do you say 'expensive' in Malay?", options: ["Murah", "Cantik", "Mahal", "Bagus"], correct: 2 }
            ],
            numbers: [
                { question: "What is 'Lima' in English?", options: ["Three", "Four", "Five", "Six"], correct: 2 },
                { question: "How do you say '10' in Malay?", options: ["Sembilan", "Sepuluh", "Sebelas", "Lapan"], correct: 1 },
                { question: "What does 'Pukul berapa?' mean?", options: ["How many?", "What time?", "How much?", "Which day?"], correct: 1 },
                { question: "What is 'Satu' in English?", options: ["One", "Two", "Three", "Zero"], correct: 0 }
            ],
            body: [
                { question: "What does 'Kepala' mean?", options: ["Hand", "Head", "Foot", "Eye"], correct: 1 },
                { question: "How do you say 'sick' in Malay?", options: ["Sihat", "Sakit", "Penat", "Lapar"], correct: 1 },
                { question: "What does 'Mata' mean?", options: ["Nose", "Mouth", "Eye", "Ear"], correct: 2 },
                { question: "How do you say 'hand' in Malay?", options: ["Kaki", "Tangan", "Badan", "Muka"], correct: 1 }
            ],
            colors: [
                { question: "What does 'Merah' mean?", options: ["Blue", "Green", "Red", "Yellow"], correct: 2 },
                { question: "How do you say 'white' in Malay?", options: ["Hitam", "Putih", "Abu-abu", "Coklat"], correct: 1 },
                { question: "What does 'Besar' mean?", options: ["Small", "Big", "Long", "Short"], correct: 1 },
                { question: "How do you say 'beautiful' in Malay?", options: ["Hodoh", "Cantik", "Buruk", "Kotor"], correct: 1 }
            ],
            weather: [
                { question: "What does 'Hujan' mean?", options: ["Sun", "Rain", "Wind", "Cloud"], correct: 1 },
                { question: "How do you say 'hot' in Malay?", options: ["Sejuk", "Panas", "Basah", "Kering"], correct: 1 },
                { question: "What does 'Angin' mean?", options: ["Rain", "Sun", "Wind", "Storm"], correct: 2 },
                { question: "How do you say 'cold' in Malay?", options: ["Panas", "Sejuk", "Lembap", "Kering"], correct: 1 }
            ],
            home: [
                { question: "What does 'Rumah' mean?", options: ["Room", "House", "Kitchen", "Bathroom"], correct: 1 },
                { question: "How do you say 'bedroom' in Malay?", options: ["Dapur", "Bilik tidur", "Ruang tamu", "Bilik air"], correct: 1 },
                { question: "What does 'Katil' mean?", options: ["Chair", "Table", "Bed", "Door"], correct: 2 },
                { question: "How do you say 'kitchen' in Malay?", options: ["Dapur", "Bilik", "Tingkap", "Pintu"], correct: 0 }
            ],
            work: [
                { question: "What does 'Kerja' mean?", options: ["Study", "Work", "Play", "Sleep"], correct: 1 },
                { question: "How do you say 'teacher' in Malay?", options: ["Pelajar", "Cikgu", "Doktor", "Jurutera"], correct: 1 },
                { question: "What does 'Sekolah' mean?", options: ["Office", "Hospital", "School", "Shop"], correct: 2 },
                { question: "How do you say 'student' in Malay?", options: ["Cikgu", "Pelajar", "Pekerja", "Doktor"], correct: 1 }
            ],
            hobbies: [
                { question: "What does 'Bola sepak' mean?", options: ["Basketball", "Football", "Tennis", "Swimming"], correct: 1 },
                { question: "How do you say 'read' in Malay?", options: ["Tulis", "Baca", "Dengar", "Tengok"], correct: 1 },
                { question: "What does 'Lagu' mean?", options: ["Dance", "Song", "Movie", "Book"], correct: 1 },
                { question: "How do you say 'swim' in Malay?", options: ["Lari", "Berenang", "Lompat", "Berjalan"], correct: 1 }
            ],
            directions: [
                { question: "What does 'Kiri' mean?", options: ["Right", "Left", "Straight", "Back"], correct: 1 },
                { question: "How do you say 'near' in Malay?", options: ["Jauh", "Dekat", "Tinggi", "Rendah"], correct: 1 },
                { question: "What does 'Jalan' mean?", options: ["House", "Road", "Bridge", "Building"], correct: 1 },
                { question: "How do you say 'where is?' in Malay?", options: ["Bila?", "Apa?", "Kat mana?", "Kenapa?"], correct: 2 }
            ],
            emotions: [
                { question: "What does 'Gembira' mean?", options: ["Sad", "Angry", "Happy", "Tired"], correct: 2 },
                { question: "How do you say 'angry' in Malay?", options: ["Sedih", "Marah", "Takut", "Penat"], correct: 1 },
                { question: "What does 'Takut' mean?", options: ["Brave", "Scared", "Calm", "Excited"], correct: 1 },
                { question: "How do you say 'love' in Malay?", options: ["Benci", "Sayang", "Suka", "Rindu"], correct: 1 }
            ]
        };

        // Keyword detection patterns
        const keywords = {
            greetings: ['selamat', 'pagi', 'petang', 'malam', 'khabar', 'apa', 'hai', 'hello', 'terima kasih', 'thank you'],
            food: ['nasi', 'ayam', 'makan', 'minum', 'teh', 'kopi', 'char kway teow', 'laksa', 'roti', 'goreng', 'order', 'lapar'],
            shopping: ['beli', 'harga', 'berapa', 'murah', 'mahal', 'jual', 'kedai', 'pasar', 'kurang', 'bagi'],
            directions: ['mana', 'jalan', 'kiri', 'kanan', 'dekat', 'jauh', 'pergi', 'sampai', 'tengok'],
            numbers: ['satu', 'dua', 'tiga', 'empat', 'lima', 'enam', 'tujuh', 'lapan', 'sembilan', 'sepuluh'],
            help: ['tolong', 'bantu', 'help', 'tak faham', 'boleh', 'can']
        };

        // Extended conversation flow templates (5-7 interactions each)
        const conversationFlows = {
            greetings: [
                { malay: "Selamat datang! Apa khabar hari ini?", english: "Welcome! How are you today?" },
                { malay: "Alhamdulillah, saya sihat. Awak dari mana?", english: "Praise be to God, I'm healthy. Where are you from?" },
                { malay: "Wah, jauh juga! Dah lama duduk sini?", english: "Wow, quite far! Have you been living here long?" },
                { malay: "Bagus! Suka tak duduk kat Singapore?", english: "Great! Do you like living in Singapore?" },
                { malay: "Nak belajar Bahasa Melayu untuk apa?", english: "What do you want to learn Malay for?" },
                { malay: "Okay! Mari kita practice sekarang!", english: "Okay! Let's practice now!" },
                { malay: "Jom cuba conversation yang lain pula!", english: "Let's try another conversation!" }
            ],
            food: [
                { malay: "Selamat datang ke kedai makan! Nak order apa?", english: "Welcome to the food stall! What would you like to order?" },
                { malay: "Kami ada nasi ayam, char kway teow, laksa, dan mee goreng. Mana satu best?", english: "We have chicken rice, char kway teow, laksa, and fried noodles. Which one is the best?" },
                { malay: "Nasi ayam memang sedap! Nak yang biasa ke yang roasted?", english: "Chicken rice is really delicious! Want the regular or roasted?" },
                { malay: "Berapa banyak? Satu jer ke dua?", english: "How many? Just one or two?" },
                { malay: "Nak minuman? Teh tarik, kopi, atau air kosong?", english: "Want drinks? Teh tarik, coffee, or plain water?" },
                { malay: "Pedas tak apa? Saya letak chili sikit.", english: "Spicy is okay? I'll put a little chili." },
                { malay: "Okay, tunggu 10 minit ya. Nanti saya panggilkan nama awak.", english: "Okay, wait 10 minutes. I'll call your name later." }
            ],
            shopping: [
                { malay: "Selamat datang ke kedai! Cari apa hari ini?", english: "Welcome to the shop! What are you looking for today?" },
                { malay: "Oh, awak nak beli buah-buahan? Pisang, epal, oren semua ada.", english: "Oh, you want to buy fruits? Bananas, apples, oranges - we have everything." },
                { malay: "Pisang ni fresh, baru sampai pagi tadi. Berapa kilo nak?", english: "These bananas are fresh, just arrived this morning. How many kilos do you want?" },
                { malay: "Dua kilo? Okay. Harga biasa RM6, tapi saya bagi RM5 je.", english: "Two kilos? Okay. Normal price RM6, but I'll give you RM5." },
                { malay: "Nak beli apa lagi? Epal Australia ni manis tau.", english: "Want to buy anything else? These Australian apples are sweet." },
                { malay: "Total semua RM12. Awak bayar cash ke card?", english: "Total everything RM12. You pay cash or card?" },
                { malay: "Terima kasih! Datang lagi ya! Buah segar selalu ada.", english: "Thank you! Come again! We always have fresh fruits." }
            ],
            directions: [
                { malay: "Eh, awak nampak keliru. Nak pergi mana?", english: "Eh, you look confused. Where do you want to go?" },
                { malay: "Orchard Road? Wah, jauh sikit. Naik MRT lagi senang.", english: "Orchard Road? Wow, quite far. Taking MRT is easier." },
                { malay: "Dari sini jalan ke Bugis MRT, lepas tu naik Green Line.", english: "From here walk to Bugis MRT, then take the Green Line." },
                { malay: "Turun kat Somerset atau Orchard station. Somerset lagi dekat.", english: "Get off at Somerset or Orchard station. Somerset is closer." },
                { malay: "Keluar je dari station, awak dah nampak shopping mall.", english: "As soon as you exit the station, you'll see the shopping mall." },
                { malay: "Journey takes about 20 minutes. Jangan lupa bawa EZ-Link card!", english: "Journey takes about 20 minutes. Don't forget to bring your EZ-Link card!" },
                { malay: "Kalau sesat, tanya kat Information Counter. Diorang boleh tolong.", english: "If you get lost, ask at the Information Counter. They can help." }
            ],
            help: [
                { malay: "Jangan risau, saya boleh tolong awak!", english: "Don't worry, I can help you!" },
                { malay: "Apa yang awak tak faham? Pronunciation ke grammar?", english: "What don't you understand? Pronunciation or grammar?" },
                { malay: "Okay, cuba cakap perlahan-lahan. Saya akan dengar.", english: "Okay, try to speak slowly. I will listen." },
                { malay: "Bagus! Pronunciation awak dah better. Cuba lagi sekali.", english: "Good! Your pronunciation is getting better. Try once more." },
                { malay: "Perfect! Awak dah pandai. Nak belajar perkataan baru?", english: "Perfect! You're getting good. Want to learn new words?" },
                { malay: "Practice makes perfect. Cakap dengan orang Melayu selalu.", english: "Practice makes perfect. Speak with Malay people often." }
            ]
        };

        // Learning progression responses
        const encouragementResponses = [
            { malay: "Bagus! Awak dah pandai!", english: "Good! You're getting better!" },
            { malay: "Betul! Teruskan belajar!", english: "Correct! Keep learning!" },
            { malay: "Hebat! Pronunciation awak bagus!", english: "Great! Your pronunciation is good!" },
            { malay: "Cuba lagi! Practice makes perfect!", english: "Try again! Practice makes perfect!" }
        ];

        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            // Show selected section
            document.getElementById(section).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            currentSection = section;
        }

        function startQuiz(theme) {
            currentQuiz = theme;
            quizScore = 0;
            quizTotal = 0;
            
            document.getElementById('quiz-themes').style.display = 'none';
            document.getElementById('quiz-content').style.display = 'block';
            
            const questionsContainer = document.getElementById('quiz-questions');
            questionsContainer.innerHTML = `<h3>üìö ${getThemeTitle(theme)}</h3>`;
            
            quizData[theme].forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'quiz-question';
                questionDiv.innerHTML = `
                    <h4>Question ${index + 1}: ${q.question}</h4>
                    <div class="quiz-options">
                        ${q.options.map((option, i) => 
                            `<button class="quiz-option" onclick="checkAnswer(this, ${i === q.correct}, ${index})">${option}</button>`
                        ).join('')}
                    </div>
                `;
                questionsContainer.appendChild(questionDiv);
            });
            
            updateQuizScore();
        }

        function getThemeTitle(theme) {
            const titles = {
                greetings: 'Greetings & Politeness',
                family: 'Family & Relationships',
                food: 'Food & Drinks',
                transport: 'Transportation',
                shopping: 'Shopping',
                numbers: 'Numbers & Time',
                body: 'Body & Health',
                colors: 'Colors & Descriptions',
                weather: 'Weather & Nature',
                home: 'Home & Living',
                work: 'Work & School',
                hobbies: 'Hobbies & Activities',
                directions: 'Directions & Places',
                emotions: 'Emotions & Feelings'
            };
            return titles[theme] || theme;
        }

        function checkAnswer(button, isCorrect, questionIndex) {
            quizTotal++;
            if (isCorrect) {
                button.style.background = '#4CAF50';
                quizScore++;
            } else {
                button.style.background = '#f44336';
                // Highlight correct answer
                const options = button.parentElement.querySelectorAll('.quiz-option');
                const correctAnswer = quizData[currentQuiz][questionIndex].correct;
                options[correctAnswer].style.background = '#4CAF50';
            }
            
            // Disable all options for this question
            button.parentElement.querySelectorAll('.quiz-option').forEach(opt => {
                opt.disabled = true;
                opt.style.cursor = 'not-allowed';
            });
            
            updateQuizScore();
        }

        function updateQuizScore() {
            document.getElementById('quiz-score').textContent = `Score: ${quizScore}/${quizTotal}`;
        }

        function backToThemes() {
            document.getElementById('quiz-themes').style.display = 'grid';
            document.getElementById('quiz-content').style.display = 'none';
            currentQuiz = null;
        }

        // Chat functions
        function addMessage(text, isUser, english = null) {
            const chatContainer = document.getElementById('chat-container');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            messageDiv.innerHTML = text;
            
            if (english && !isUser) {
                const bilingualDiv = document.createElement('div');
                bilingualDiv.className = 'bilingual';
                bilingualDiv.textContent = english;
                messageDiv.appendChild(bilingualDiv);
            }
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            if (message && currentSection === 'chat') {
                addMessage(message, true);
                input.value = '';
                
                setTimeout(() => {
                    const response = getContextualResponse(message);
                    addMessage(response.malay, false, response.english);
                }, 1000);
            }
        }

        function sendQuickReply(malay, english) {
            if (currentSection === 'chat') {
                addMessage(malay, true);
                setTimeout(() => {
                    const response = getContextualResponse(malay);
                    addMessage(response.malay, false, response.english);
                }, 1000);
            }
        }

        function detectTopic(message) {
            const lowerMessage = message.toLowerCase();
            
            for (const [topic, keywordList] of Object.entries(keywords)) {
                for (const keyword of keywordList) {
                    if (lowerMessage.includes(keyword)) {
                        return topic;
                    }
                }
            }
            return 'general';
        }

        function getContextualResponse(userMessage) {
            const detectedTopic = detectTopic(userMessage);
            
            // If we detect a new topic, switch to it
            if (detectedTopic !== 'general' && detectedTopic !== currentTopic) {
                currentTopic = detectedTopic;
                conversationStep = 0;
            }
            
            // If we're in a topic conversation, continue the flow
            if (currentTopic && conversationFlows[currentTopic]) {
                const responses = conversationFlows[currentTopic];
                
                // Continue conversation flow if within range
                if (conversationStep < responses.length) {
                    const response = responses[conversationStep];
                    conversationStep++;
                    return response;
                }
                
                // After completing the flow, give encouragement and suggest new topics
                if (conversationStep === responses.length) {
                    conversationStep++;
                    const encouragement = encouragementResponses[Math.floor(Math.random() * encouragementResponses.length)];
                    return encouragement;
                }
                
                // After encouragement, cycle back or suggest new conversation
                if (conversationStep > responses.length) {
                    const followUp = [
                        { malay: "Nak practice topic lain? Cuba click button di bawah!", english: "Want to practice another topic? Try clicking the buttons below!" },
                        { malay: "Awak dah pandai! Mari cuba conversation baru!", english: "You're getting good! Let's try a new conversation!" },
                        { malay: "Hebat! Sekarang cuba roleplay scenario pulak!", english: "Great! Now try the roleplay scenarios!" }
                    ];
                    return followUp[Math.floor(Math.random() * followUp.length)];
                }
            }
            
            // Fallback to general helpful responses
            return getGeneralResponse(userMessage);
        }

        function getGeneralResponse(message) {
            const generalResponses = [
                { malay: "Maaf, saya tak faham. Boleh repeat?", english: "Sorry, I don't understand. Can you repeat?" },
                { malay: "Cuba cakap dalam Bahasa Melayu.", english: "Try speaking in Malay." },
                { malay: "Saya nak tolong awak belajar! Apa topic yang awak nak?", english: "I want to help you learn! What topic do you want?" },
                { malay: "Mari cuba conversation lain! Selamat pagi!", english: "Let's try another conversation! Good morning!" }
            ];
            
            return generalResponses[Math.floor(Math.random() * generalResponses.length)];
        }

        function resetConversation() {
            currentTopic = null;
            conversationStep = 0;
            conversationContext = {};
        }

        function startTopicConversation(topic) {
            currentTopic = topic;
            conversationStep = 0;
            
            if (conversationFlows[topic]) {
                const firstResponse = conversationFlows[topic][0];
                addMessage(firstResponse.malay, false, firstResponse.english);
                conversationStep = 1;
            }
        }

        function updateQuickReplies() {
            // This function can be expanded to show context-aware quick replies
            const quickRepliesContainer = document.querySelector('.quick-replies');
            if (currentTopic) {
                // Show topic-specific quick replies
                const topicReplies = {
                    greetings: ['Khabar baik!', 'Saya sihat', 'Terima kasih'],
                    food: ['Nasi ayam', 'Teh tarik', 'Berapa harga?'],
                    shopping: ['Berapa harga?', 'Boleh kurang?', 'Saya nak beli'],
                    directions: ['Kat mana?', 'Jalan kiri', 'Terima kasih']
                };
                
                // Implementation can be expanded later for dynamic quick replies
            }
        }

        function startRoleplay(scenario) {
            showSection('chat');
            
            const scenarios = {
                food: { malay: "Selamat datang! Nak order apa?", english: "Welcome! What would you like to order?" },
                shopping: { malay: "Nak beli apa hari ni?", english: "What would you like to buy today?" },
                directions: { malay: "Boleh saya tolong?", english: "Can I help you?" },
                clinic: { malay: "Apa masalah awak hari ni?", english: "What's your problem today?" },
                shop: { malay: "Cari apa, bang?", english: "What are you looking for, bro?" },
                bank: { malay: "Selamat pagi. Saya mahu buka akaun untuk anak saya.", english: "Good morning. I want to open an account for my child." },
                jobinterview: { malay: "Boleh perkenalkan diri?", english: "Can I introduce myself?" },
                hotel: { malay: "Selamat petang. Saya mahu daftar masuk.", english: "Good afternoon. I want to check in." },
                emergency: { malay: "Encik, anak saya hilang di pasar.", english: "Sir, my child is lost in the market." },
                friends: { malay: "Hai, nama saya Farah. Awak siapa?", english: "Hi, my name is Farah. Who are you?" },
                postoffice: { malay: "Saya mahu hantar bungkusan ke Johor.", english: "I want to send a package to Johor." },
                housing: { malay: "Saya mahu lihat rumah sewa tiga bilik.", english: "I want to view a three-room rental house." },
                cultural: { malay: "Nenek, kenapa ramai orang hari ini?", english: "Grandmother, why are there so many people today?" }
            };
            
            // Clear chat and start scenario
            document.getElementById('chat-container').innerHTML = '';
            const intro = scenarios[scenario];
            addMessage(intro.malay, false, intro.english);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showSection('home');
        });
    </script>
</body>
</html>